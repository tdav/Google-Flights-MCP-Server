# Сервер MCP и API Google Flights

Этот проект предоставляет сервер Model Context Protocol (MCP) для интеграции с Google Flights, а также полнофункциональный Web API. Он позволяет AI-агентам и другим клиентам искать авиабилеты, отслеживать историю поиска и управлять данными о полетах.

## Обзор проекта

*   **Тип:** Решение на C# .NET 8.0
*   **Цель:** Предоставить возможности поиска Google Flights через MCP (для ИИ) и REST API (для веб/других клиентов).
*   **Ключевые возможности:**
    *   Поиск авиабилетов (скрапинг/интеграция).
    *   Отслеживание истории поиска (PostgreSQL).
    *   Сервер MCP через Stdio (стандартный ввод/вывод).
    *   Документация Swagger/OpenAPI.

## Архитектура и технологический стек

*   **Язык:** C# (.NET 8.0)
*   **База данных:** PostgreSQL (используется Entity Framework Core)
*   **Фреймворк API:** ASP.NET Core Web API
*   **Протокол MCP:** Кастомная реализация через Standard Input/Output (Stdio)
*   **Библиотеки:**
    *   `AngleSharp`: Парсинг HTML/скрапинг.
    *   `Serilog`: Структурированное логирование.
    *   `xUnit`, `FluentAssertions`, `Moq`: Тестирование.
*   **Контейнеризация:** Docker и Docker Compose.

## Структура проекта

```text
Google-Flights-MCP-Server/
├── GoogleFlights.Core/       # Общие модели, сущности и основная бизнес-логика
├── GoogleFlightsApi/         # Проект RESTful Web API (ASP.NET Core)
│   ├── Controllers/          # Эндпоинты API (Flights, History, Health)
│   ├── Data/                 # EF Core DbContext и сущности
│   ├── Services/             # Сервисы бизнес-логики
│   └── appsettings.json      # Конфигурация (подключение к БД и т.д.)
├── GoogleFlightsMcp/         # Консольное приложение, реализующее сервер MCP
│   ├── Mcp/                  # Реализация JSON-RPC 2.0
│   └── Tools/                # Инструменты, доступные для клиента MCP
├── GoogleFlightsApi.Tests/   # Модульные и интеграционные тесты
├── docker/                   # Dockerfile
└── docker-compose.yml        # Настройка мульти-контейнеров (Приложение + БД)
```

## Установка и использование

### Предварительные требования
*   .NET 8.0 SDK
*   PostgreSQL (или Docker)

### Сборка
```bash
dotnet restore
dotnet build
```

### Запуск Web API
1.  **Настройка БД:** Обновите `GoogleFlightsApi/appsettings.json`, указав строку подключения к PostgreSQL.
2.  **Запуск:**
    ```bash
    cd GoogleFlightsApi
    dotnet run
    ```
    *   Swagger UI: `http://localhost:8080/swagger`

### Запуск с Docker
```bash
docker-compose up --build
```

### Запуск сервера MCP
Сервер MCP представляет собой консольное приложение, предназначенное для запуска клиентом MCP (например, Claude Desktop или расширение IDE для ИИ).
```bash
cd GoogleFlightsMcp
dotnet run
```
*   **Примечание:** Обмен данными происходит через Stdio. Логи пишутся в `stderr`, чтобы не мешать протоколу JSON-RPC в `stdout`.

### Тестирование
```bash
dotnet test
```


## Соглашения по разработке

*   **Стиль кода:** Стандартные соглашения C# .NET.
*   **Логирование:** Использовать `Serilog`. В сервере MCP убедитесь, что *все* логи идут в `stderr` (настроено в `Program.cs`).
*   **База данных:** Использовать миграции Entity Framework Core для изменений схемы (`dotnet ef migrations add ...`).
*   **Документация:** Убедитесь, что эндпоинты API документированы для Swagger.
*   **DTO:** Использовать отдельные DTO (Data Transfer Objects) для запросов/ответов API, сопоставленные с внутренними сущностями.

## Очень важно:
- **Никогда не придумывайте информацию**; если информация недоступна, честно скажите, что вы не можете найти ответ в документации
- **Всегда проверяйте релевантность** полученного содержимого перед включением его в ответ
- **Будьте точны и конкретны** в своих ответах, избегайте общих фраз
- **Используйте технический язык** соответствующий профессиональному уровню пользователя
- **Всегда проверяйте, что вы используете правильную версию документации**, если пользователь указал версию продукта DevExpress
- **Все выводимые ответы должны быть на русском языке**
- **Всегда следуйте этому рабочему процессу и ограничениям для обеспечения точности и полезности ваших ответов**
- **Всегда создайте план и делайте шаг за шагом**